<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Risultato Pianificazione</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header>
    <h1>ðŸ“Š Risultato Pianificazione</h1>
    <a href="/" class="btn-back">â¬… Torna alla Dashboard</a>
</header>

<div class="container-result">

    <div class="section">
        <h2>Stato Progetti</h2>
        {% for p in progetti %}
            <div class="card-result {{ 'success' if p.fattibile else 'error' }}">
                <div class="header-res">
                    <h3>[P{{ p.priorita }}] {{ p.nome }}</h3>
                    <span>Scadenza: {{ p.data_consegna }}</span>
                </div>
                
                <p><strong>Fabbisogno Reale:</strong> {{ p.ore_totali_richieste }} ore</p>
                <p><strong>Margine Applicato:</strong> {{ p.margine_percentuale }}% (Buffer interno)</p>

                {% if p.fattibile %}
                    <div class="assigned-box">
                        <strong>âœ… Assegnato a:</strong>
                        <ul>
                            {% for r in p.risorse_assegnate %}
                                <li>{{ r.nome }} ({{ r.skill }})</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% else %}
                    <div class="error-box">
                        <strong>â›” NON FATTIBILE</strong><br>
                        Mancano ancora {{ p.ore_ancora_da_coprire }} ore da coprire.
                        Risorse insufficienti o buffer di sicurezza non rispettato.
                    </div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <div class="section">
        <h2>Carico Risorse</h2>
        {% for r in risorse %}
            <div class="card-resource">
                <h4>{{ r.nome }} <small>({{ r.skill }})</small></h4>
                <div class="progress-bar-bg">
                    {% if r.ore_totali_disponibili > 0 %}
                        {% set perc = (r.ore_impegnate / r.ore_totali_disponibili * 100) | int %}
                    {% else %}
                        {% set perc = 0 %}
                    {% endif %}
                    
                    <div class="progress-bar-fill" style="width: {{ perc }}%;">{{ perc }}%</div>
                </div>
                <p><small>Impegnate: {{ r.ore_impegnate }}h / Totali: {{ r.ore_totali_disponibili }}h</small></p>
            </div>
        {% endfor %}
    </div>

</div>

</body>
</html>