<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Pianificatore Risorse</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<header>
    <h1>üìÖ Pianificatore Deterministico</h1>
    <a href="/calcola_piano" class="btn-calcola">ELABORA PIANO üöÄ</a>
</header>

<div class="container">
    
    <div class="col-input">
        
        <div class="card">
            <h2>Aggiungi Risorsa</h2>
            <form action="/aggiungi_risorsa" method="POST">
                <input type="text" name="nome" placeholder="Nome (es. Mario Rossi)" required>
                <select name="skill">
                    <option value="Developer">Developer</option>
                    <option value="Tester">Tester</option>
                    <option value="PM">Project Manager</option>
                </select>
                <input type="number" name="ore" placeholder="Ore Totali Disponibili" required>
                <button type="submit">Salva Risorsa</button>
            </form>
        </div>

        <div class="card" style="border-left: 5px solid #f39c12;">
            <h2>Registra Ferie/Assenza üèñÔ∏è</h2>
            <form action="/aggiungi_assenza" method="POST">
                <label>Chi sar√† assente?</label>
                <select name="risorsa_id" required>
                    {% for r in risorse %}
                    <option value="{{ r.id }}">{{ r.nome }} ({{ r.skill }})</option>
                    {% endfor %}
                </select>
                
                <div class="row">
                    <div>
                        <label>Dal</label>
                        <input type="date" name="inizio" required>
                    </div>
                    <div>
                        <label>Al</label>
                        <input type="date" name="fine" required>
                    </div>
                </div>

                <input type="text" name="motivo" placeholder="Motivo (es. Ferie Estive)" required>
                
                <button type="submit" style="background-color: #f39c12;">Registra Assenza</button>
            </form>
        </div>

        <div class="card">
            <h2>Aggiungi Progetto</h2>
            
            <form action="/aggiungi_progetto" method="POST" onsubmit="return validaPercentuali()">
                <input type="text" name="nome" placeholder="Nome Progetto" required>
                
                <div class="row">
                    <label>Priorit√†</label>
                    <input type="number" name="priorita" value="5" min="1" max="10">
                </div>
                
                <div class="row">
                    <label>Consegna</label>
                    <input type="date" name="data" required>
                </div>

                <input type="number" name="ore" placeholder="Ore Stimate Totali" required>
                
                <div class="row">
                    <label>Margine %</label>
                    <input type="number" name="margine" value="15">
                </div>

                <h4>Composizione Team Richiesta:</h4>
                
                <div class="row">
                    <label style="flex:1">Developer (Qty / %):</label>
                    <input type="number" name="qty_dev" value="0" min="0" style="flex:1" placeholder="N¬∞">
                    <input type="number" name="pct_dev" class="perc-input" value="0" min="0" max="100" style="flex:1" placeholder="%">
                </div>
                
                <div class="row">
                    <label style="flex:1">Tester (Qty / %):</label>
                    <input type="number" name="qty_tester" value="0" min="0" style="flex:1" placeholder="N¬∞">
                    <input type="number" name="pct_tester" class="perc-input" value="0" min="0" max="100" style="flex:1" placeholder="%">
                </div>
                
                <div class="row">
                    <label style="flex:1">PM (Qty / %):</label>
                    <input type="number" name="qty_pm" value="0" min="0" style="flex:1" placeholder="N¬∞">
                    <input type="number" name="pct_pm" class="perc-input" value="0" min="0" max="100" style="flex:1" placeholder="%">
                </div>
                
                <p style="font-size:0.8rem; color:#666; margin-top:5px;">* La somma delle percentuali deve fare 100%.</p>

                <button type="submit" class="btn-progetto" style="margin-top:15px">Salva Progetto</button>
            </form>
        </div>
    </div>

    <div class="col-data">
        <h2>üìÇ Database Attuale</h2>
        
        <h3>Risorse Disponibili</h3>
        <table>
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Skill</th>
                    <th>Ore Tot.</th>
                    <th>Azioni</th> </tr>
            </thead>
            <tbody>
                {% for r in risorse %}
                <tr>
                    <td>{{ r.nome }}</td>
                    <td><span class="badge">{{ r.skill }}</span></td>
                    <td>
                        {{ r.ore_totali }}h
                        {% if r.assenze %}
                            <br><small style="color:#e67e22; font-weight:bold;">(-{{ r.assenze|length }} periodi assenza)</small>
                        {% endif %}
                    </td>
                    <td>
                        <a href="/modifica_risorsa/{{ r.id }}" style="text-decoration: none;">‚úèÔ∏è</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3>Progetti in Coda</h3>
        <table>
            <thead>
                <tr>
                    <th>Prio</th>
                    <th>Nome</th>
                    <th>Scadenza</th>
                    <th>Ore</th>
                    <th>Team</th>
                    <th>Azioni</th> </tr>
            </thead>
            <tbody>
                {% for p in progetti %}
                <tr>
                    <td><strong>P{{ p.priorita }}</strong></td>
                    <td>{{ p.nome }}</td>
                    <td>{{ p.data_consegna }}</td>
                    <td>{{ p.ore_stimate }}h (+{{ p.margine }}%)</td>
                    <td style="font-size: 0.8rem; color: #666;">{{ p.requisiti_str }}</td>
                    
                    <td>
                        <a href="/modifica_progetto/{{ p.id }}" style="text-decoration: none;">‚úèÔ∏è</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

<script>
    function validaPercentuali() {
        var p1 = parseInt(document.getElementsByName('pct_dev')[0].value) || 0;
        var p2 = parseInt(document.getElementsByName('pct_tester')[0].value) || 0;
        var p3 = parseInt(document.getElementsByName('pct_pm')[0].value) || 0;

        var totale = p1 + p2 + p3;

        if (totale !== 100) {
            alert("‚ö†Ô∏è ATTENZIONE!\n\nLa somma delle percentuali deve essere esattamente 100%.\nSomma attuale: " + totale + "%");
            return false;
        }
        
        return true;
    }
</script>

</body>
</html>